/**
 * Created by vimukthi on 2/10/16.
 */

/**
 *
 "shipper_account.slug": "mondialrelay",
 "shipper_account.description": "mondialrelay",
 "shipper_account.timezone": "Europe/London",
 "shipper_account.address.contact_name": "Buckinghamshire Livingstone West",
 "shipper_account.address.company_name": "The Royal Family",
 "shipper_account.address.email": "buckstonewest@royalfamily.com",
 "shipper_account.address.street1": "No.1 Northwesthamsexshirecaster Boulevard",
 "shipper_account.address.street2": "Turing Test Town",
 "shipper_account.address.city": "Thisisalongnameingshumshire",
 "shipper_account.address.postal_code": "B17 0WD",
 "shipper_account.address.state": "Sussex",
 "shipper_account.address.country": "FRA",
 "shipper_account.address.type": "residential",
 "shipper_account.credentials.merchant_id": "BDTEST13",
 "shipper_account.credentials.collection_mode": "CCC",
 "shipper_account.credentials.language": "FR"
 "service_options: 100,
 "paper_size": "a4",
 "service_type": "mondialrelay_home_delivery_for_heavy_or_bulky_shipments",
 "is_document": false,
 "references" : 'ewrew',
 "billing.paid_by": "shipper",
 "billing.method.type": "account",
 "billing.method.account_number": "V8E053",
 "shipment.ship_from.contact_name": "FirstName",
 "shipment.ship_from.phone": "+33153418303",
 "shipment.ship_from.fax": "+1 206-654-3100",
 "shipment.ship_from.email": "foo@foo.com",
 "shipment.ship_from.company_name": "Foo Store",
 "shipment.ship_from.street1": "Rue Lepic",
 "shipment.ship_from.city": "Paris",
 "shipment.ship_from.country": "FRA",
 "shipment.ship_from.type": "business",
 "shipment.ship_from.tax_id": "911-70-1234",
 "shipment.ship_from.postal_code": "75001",
 "shipment.ship_to.contact_name": "ConsigneeFirstname",
 "shipment.ship_to.phone": "+33153418312",
 "shipment.ship_to.fax": "302-0123-1234",
 "shipment.ship_to.email": "support@buyer.com",
 "shipment.ship_to.company_name": "The Receiving Company",
 "shipment.ship_to.street1": "A55 autoroute",
 "shipment.ship_to.street2": "Wow Avenue",
 "shipment.ship_to.street3": "Boring part of town",
 "shipment.ship_to.city": "London",
 "shipment.ship_to.postal_code": "75001",
 "shipment.ship_to.country": "FRA",
 "shipment.ship_to.type": "residential",
 "shipment.ship_to.tax_id": "TIN728992",
 "shipment.parcels": "ewq",
 "customs.importer_address.contact_name": "Sir Foo",
 "customs.importer_address.phone": "999-34334-324",
 "customs.importer_address.fax": "999-34334-325",
 "customs.importer_address.email": "foo@foo.com",
 "customs.importer_address.company_name": "Foo Store",
 "customs.importer_address.street1": "100 MAIN ST",
 "customs.importer_address.street2": "PO BOX 1022",
 "customs.importer_address.street3": "SEATTLE WA 98104",
 "customs.importer_address.city": "Seattle",
 "customs.importer_address.state": "WA",
 "customs.importer_address.postal_code": "77055",
 "customs.importer_address.country": "FRA",
 "customs.importer_address.type": "business",
 "customs.importer_address.tax_id": "911-70-1234",
 "customs.purpose": "sample",
 "customs.terms_of_trade": "ddu",
 "customs.billing.paid_by": "shipper",
 "customs.billing.method.type": "account",
 "customs.billing.method.account_number": "V8E053"

 "shipper_account.slug",
 "shipper_account.description",
 "shipper_account.timezone",
 "shipper_account.address.contact_name",
 "shipper_account.address.company_name",
 "shipper_account.address.email",
 "shipper_account.address.street1",
 "shipper_account.address.street2",
 "shipper_account.address.city",
 "shipper_account.address.postal_code",
 "shipper_account.address.state",
 "shipper_account.address.country",
 "shipper_account.address.type",
 "shipper_account.credentials.merchant_id",
 "shipper_account.credentials.collection_mode",
 "shipper_account.credentials.language"
 "service_options",
 "paper_size",
 "service_type",
 "is_document",
 "references",
 "billing.paid_by",
 "billing.method.type",
 "billing.method.account_number",
 "shipment.ship_from.contact_name",
 "shipment.ship_from.phone",
 "shipment.ship_from.fax",
 "shipment.ship_from.email",
 "shipment.ship_from.company_name",
 "shipment.ship_from.street1",
 "shipment.ship_from.city",
 "shipment.ship_from.country",
 "shipment.ship_from.type",
 "shipment.ship_from.tax_id",
 "shipment.ship_from.postal_code",
 "shipment.ship_to.contact_name",
 "shipment.ship_to.phone",
 "shipment.ship_to.fax",
 "shipment.ship_to.email",
 "shipment.ship_to.company_name",
 "shipment.ship_to.street1",
 "shipment.ship_to.street2",
 "shipment.ship_to.street3",
 "shipment.ship_to.city",
 "shipment.ship_to.postal_code",
 "shipment.ship_to.country",
 "shipment.ship_to.type",
 "shipment.ship_to.tax_id",
 "shipment.parcels",
 "customs.importer_address.contact_name",
 "customs.importer_address.phone",
 "customs.importer_address.fax",
 "customs.importer_address.email",
 "customs.importer_address.company_name",
 "customs.importer_address.street1",
 "customs.importer_address.street2",
 "customs.importer_address.street3",
 "customs.importer_address.city",
 "customs.importer_address.state",
 "customs.importer_address.postal_code",
 "customs.importer_address.country",
 "customs.importer_address.type",
 "customs.importer_address.tax_id",
 "customs.purpose",
 "customs.terms_of_trade",
 "customs.billing.paid_by",
 "customs.billing.method.type",
 "customs.billing.method.account_number"
 */

'use strict';

const noflo = require("noflo");
const _ = require("lodash");

class PostmenLabelRequest extends noflo.Component {

    constructor() {
        super();
        this.description = "This component receives a Postmen label request on its input and " +
            "outputs each key separately to be mapped";
        this.paramKeys = [
            "shipper_account.id",
            "service_options",
            "paper_size",
            "service_type",
            "is_document",
            "references",
            "billing.paid_by",
            "billing.method.type",
            "billing.method.account_number",
            "shipment.ship_from.contact_name",
            "shipment.ship_from.phone",
            "shipment.ship_from.fax",
            "shipment.ship_from.email",
            "shipment.ship_from.company_name",
            "shipment.ship_from.street1",
            "shipment.ship_from.city",
            "shipment.ship_from.country",
            "shipment.ship_from.type",
            "shipment.ship_from.tax_id",
            "shipment.ship_from.postal_code",
            "shipment.ship_to.contact_name",
            "shipment.ship_to.phone",
            "shipment.ship_to.fax",
            "shipment.ship_to.email",
            "shipment.ship_to.company_name",
            "shipment.ship_to.street1",
            "shipment.ship_to.street2",
            "shipment.ship_to.street3",
            "shipment.ship_to.city",
            "shipment.ship_to.postal_code",
            "shipment.ship_to.country",
            "shipment.ship_to.type",
            "shipment.ship_to.tax_id",
            "shipment.parcels"
        ];

        this.inPorts.postmen_request = new noflo.Port('all');
        this.inPorts.postmen_request.on('data', (value) => {
            return this.sendParams(value);
        });

        for (let i = 0; i < this.paramKeys.length; i++) {
            this.outPorts.add(this.paramKeys[i], { datatype: 'all' });
        }
    }

    sendParams(req) {
        for (let i = 0; i < this.paramKeys.length; i++) {
            this.outPorts[this.paramKeys[i]].send(_.get(req, this.paramKeys[i]));
        }
        return ;
    }
}

exports.getComponent = () => {
    return new PostmenLabelRequest();
};